name: build_JOGDF_linux64


on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: build dependencies
        run: |
          sudo apt-get install openjdk-8-jre openjdk-8-jdk
          echo 'export PATH="/usr/local/opt/openjdk@11/bin:$PATH"' >> /Users/runner/.bash_profile
          export JAVA_HOME=/usr/lib/jvm/java/
          export CPPFLAGS="-I/usr/local/opt/openjdk@11/include"
          echo Building ogdf
          cd ogdf
          cmake .
          make -j 1

          echo Building tmap
          # cd ../tmap
          # cmake .
          # make -j 1

          echo Building Java-tmap Interface
          cd ../src
          cmake .
          make -j 1
      
      - name: build jogdf
        run: |
          mkdir build
          cd build
          cmake .. 
          make -j 1
          cmake --build . --target install

      - name: Run Test
        # working-directory: api/build/test
        # run: ./CLPTest
        run: echo skipped

      - name: package
        run: |
          cd build/native/
          zip Jogdf -r .
      - name: create release
        uses: ncipollo/release-action@v1
        with:
          artifacts: "build/native/*.zip"
          name: "Jogdf for linux64"
      
